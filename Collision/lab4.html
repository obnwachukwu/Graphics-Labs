

<!DOCTYPE html>

<html>

<head>
  <meta charset="UTF-8">
  <title>Canvas</title>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <style type="text/css">
    canvas {
      background-color: lightcoral;
      border: 3px solid black;
    }
  </style>
  <h1>BOGDAN NWACHUKWU</h1>
</head>

<body>

  <canvas id="canvas-for-ball" width="600" height="300"></canvas>
  <div id="score1" style="margin-top:10px; font-weight:bold; font-size:18px; color:black;">Left Paddle Score: 0</div>
  <div id="score2" style="margin-top:5px; font-weight:bold; font-size:18px; color:black;">Right Paddle Score: 0</div>
  <div id="collision-message" style= color:brown>COLLISION DETECTED!</div>
  
  <script type="text/javascript">
    //Class PacmanBall
    class PacmanBall { 
      constructor(x, y, xSpeed, ySpeed, radius,color) {
        this.x = x; this.y = y;
        this.xSpeed = xSpeed;
        this.ySpeed = ySpeed;
        this.radius = radius;
        this.rotation = 0; //facing direction
        this.collidingLeft = false;
        this.collidingRight = false;
        this.color = color;

      }
      
      

      //Move method
      move(canvas) {
        this.x += this.xSpeed;
        this.y += this.ySpeed;


        //Bounce off walls
        if (this.x + this.radius >= canvas.width) {
          rightScore = Math.max(0, rightScore - 1);
          document.getElementById("score2").innerText = "Right Paddle Score: " + rightScore;
          this.xSpeed *= -1;
          this.rotation += Math.PI;
        }

        if (this.x - this.radius <= 0) {
          leftScore = Math.max(0, leftScore - 1);
          document.getElementById("score1").innerText = "Left Paddle Score: " + leftScore;
          this.xSpeed *= -1;
          this.rotation += Math.PI;
      }

        
  if (this.y + this.radius >= canvas.height || this.y - this.radius <= 0) {
    this.ySpeed *= -1;
    this.rotation += Math.PI;
  }

        
}
        //Draw method - draws the Pacman shape
      draw(ctx) {
        const mouth = Math.PI / 6;

        ctx.beginPath();
        ctx.moveTo(this.x, this.y);

        const grad=ctx.createRadialGradient(this.x, this.y, 5, this.x, this.y, this.radius);
        grad.addColorStop(0,"green");
        grad.addColorStop(1,"lightgreen"); 


        ctx.arc(this.x, this.y, this.radius, mouth + this.rotation, 2 * Math.PI - mouth + this.rotation);
        ctx.closePath();
        ctx.fillStyle = grad;
        ctx.fill();
        ctx.stroke();
      }
      rotate(step = 0.05) {
        this.rotation += step;
      }

    }


    class Paddle{
    constructor(x,y,width,height,color,grad)
      {
      this.x = x; 
      this.y = y;
      this.width = 50; 
      this.height = height;
      this.color = color;
      }

      draw(ctx){
        //Draw a cirlce istead of a rectangle
        const grad=ctx.createRadialGradient(150,75,15,150,75,150);
        grad.addColorStop(0,"lightblue");
        grad.addColorStop(1,"darkblue"); 
        
        
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(this.x + this.width/2, this.y + this.height/2, this.width/2, 0, 2 * Math.PI);
        ctx.fill();
        }

      move (dy, canvas){
        this.y += dy;
        //keep inside canvas
        if(this.y < 0) this.y = 0;
        if(this.y + this.height > canvas.height) this.y = canvas.height - this.height;
      }
    }

    // Gets a handle to the element with id canvasOne.
    var canvas = document.getElementById("canvas-for-ball");
    // Get a 2D context for the canAvas.
    var ctx = canvas.getContext("2d");

    //position of the 2 Paddles
    var pacman = new PacmanBall(30, 125, 4, 6, 30,color = "red");
    var leftPaddle = new Paddle(20,105,15,60,"blue");
    var rightPaddle = new Paddle(canvas.width - 65, 100,15,60,"green");


    //Score variables
    var leftScore = 0;
    var rightScore = 0;

    //Array of balls4
    var balls = [];
    ballspush(new PacmanBall(100,125,4,6,30, "lightgreen"));

    

    // Collision variables for time and meassage
    let collisionMessageVisible = false;
    let collisionMessageTimer = 0;

    //keypresses with jQuery
		$(document.body).on('keydown', function(e) {
			console.log(e.which);
			switch (e.which) {
        
        case 38:
          console.log('up arrow key pressed')
          rightPaddle.move(-10,canvas);
          break;

          case 40:
          console.log('down arrow key pressed')
          rightPaddle.move(10,canvas);
          break;

          case 87:
          console.log('W key pressed')
          leftPaddle.move(-10,canvas);
          break;

          case 83:
          console.log('S key pressed')
          leftPaddle.move(10,canvas);
          break;
			}
		});

    //mouse control
    canvas.addEventListener("mousemove", function (event) {
      var rect = canvas.getBoundingClientRect();
      var mouseY = event.clientY - rect.top;

      leftPaddle.y = mouseY - leftPaddle.height / 2;
    });


    //Collision detection
    function collisionDetect(){
        var distance1 = Math.sqrt(Math.pow(pacman.x - leftPaddle.x,2) + Math.pow(pacman.y-leftPaddle.y,2));
        var distance2 = Math.sqrt(Math.pow(pacman.x - rightPaddle.x,2) + Math.pow(pacman.y-rightPaddle.y,2));
        
        //Left Paddle
        if(distance1 < pacman.radius + leftPaddle.width / 2){
          if(!pacman.collidingLeft) {
            pacman.xSpeed = Math.abs(pacman.xSpeed);
            pacman.rotation += Math.PI;
            console.log("Left Collison" + distance1);
            pacman.collidingLeft = true;

            leftScore++;
            document.getElementById("score1").innerText = "Left Paddle Score: " + leftScore;
            this.xSpeed *= -1;
          }
      } else {
        pacman.collidingLeft = false;
      }

      // Right Paddle
      if (distance2 < pacman.radius + rightPaddle.width / 2) {
        if (!pacman.collidingRight) {
          pacman.xSpeed = -Math.abs(pacman.xSpeed);
          pacman.rotation += Math.PI;
          console.log("Right Collison" + distance2);
          pacman.collidingRight = true;

          rightScore++;
          document.getElementById("score2").innerText = "Right Paddle Score: " + rightScore;
          showMessage();
          this.xSpeed *= -1;
        }
      } else {
        pacman.collidingRight = false;
      }
    }


    function showMessage() {
      var msg =  document.getElementById("collision-message");
       msg.style.display = "block";

      setTimeout(() => {
    msg.style.display = "none";
  }, 1000);    
    }
    //   //closest point on the paddle to the center of the pacman
    //   let closestX = Math.max(paddle.x, Math.min(pacman.x, paddle.x + paddle.width));
    //   let closestY = Math.max(paddle.y, Math.min(pacman.y, paddle.y + paddle.height));

      //Calculate the distance between the pacman and the closest point
    //   let distanceX = pacman.x - closest

    // A function to repeat every time the animation loops.
    function repeatme() {
      // Draw the ball (stroked, not filled).
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      pacman.draw(ctx);
      pacman.move(canvas);
      pacman.rotate();
      rightPaddle.draw(ctx);
      leftPaddle.draw(ctx);
      collisionDetect();
   

      window.requestAnimationFrame(repeatme);
    }

    // Get the animation going.
    repeatme();
  </script>

</body>

</html>